angular.module("myApp",["ngRoute","ngAnimate","ngSanitize","infinite-scroll","wu.masonry","toaster","ngTagsInput","myApp.controllers","myApp.filters","myApp.services","myApp.factories","myApp.directives"]).value("THROTTLE_MILLISECONDS",300).config(["$routeProvider","$locationProvider",function(t,e){return t.when("/",{templateUrl:"partials/index",controller:"IndexCtrl"}).when("/member",{templateUrl:"partials/member",controller:"MemberCtrl"}).when("/list",{templateUrl:"partials/list",controller:"ListCtrl"}).when("/find",{templateUrl:"partials/find",controller:"FindCtrl"}).when("/extract/:id?",{templateUrl:"partials/extract",controller:"ExtractCtrl"}).when("/mao",{templateUrl:"partials/mao"}).when("/fav",{templateUrl:"partials/fav",controller:"FavCtrl"}).when("/config",{templateUrl:"partials/config",controller:"ConfigCtrl"}).when("/help",{templateUrl:"partials/help",controller:"HelpCtrl"}).when("/logout",{redirectTo:"/"}).when("http://127.0.0.1:4040/auth/twitter/callback",{redirectTo:"/"}).otherwise({redirectTo:"/"}),e.html5Mode(!0)}]),angular.module("myApp.controllers",[]),angular.module("myApp.directives",[]).directive("dotLoader",function(){return{restrict:"E",template:'<div class="wrapper">\n  <div class="dot"></div>\n  <div class="dot"></div>\n  <div class="dot"></div>\n</div>'}}).directive("imgPreload",function(){return{restrict:"A",link:function(t,e){e.on("load",function(){e.addClass("in")}).on("error",function(){})}}}).directive("scrollOnClick",function(){return{restrict:"A",scope:{scrollTo:"@"},link:function(t,e){return e.on("click",function(){return $("html, body").animate({scrollTop:$(t.scrollTo).offset().top},"slow")})}}}).directive("resize",["$timeout","$rootScope","$window",function(t,e,r){return{link:function(){var i;return i=!1,angular.element(r).on("load resize",function(){i&&t.cancel(i),i=t(function(){var t,r,i;return r=angular.element(document).find("html"),t=r[0].clientWidth,i=700>t?"list":"grid",e.$broadcast("resize::resize",{layoutType:i})},200)})}}}]).directive("zoomImage",["$compile","$rootScope","TweetService",function(){return{restrict:"A",link:function(t,e,r){return e.on("click",function(){var t,e,i,n,s,a;return e=angular.element(document).find("html"),i=angular.element(document).find(".image-layer"),t='<div class="image-layer__container">\n  <img class="image-layer__img"/>\n  <div class="image-layer__loading">\n    <img src="./images/loaders/tail-spin.svg" />\n  </div>\n</div>',i.html(t),i.addClass("image-layer__overlay"),s=angular.element(document).find(".image-layer__img"),a=angular.element(document).find(".image-layer__loading"),s.hide(),s.attr("src",(""+r.imgSrc).replace(":small",":orig")).load(function(){var t,r,i,n,o,u,c;return a.remove(),o=s[0].naturalHeight,c=s[0].naturalWidth,u=o/c*100,t=e[0].clientHeight,i=e[0].clientWidth,r=t/i*100,n=u-r>=0?"h":"w",s.addClass("image-layer__img-"+n+"-wide"),s.fadeIn(1)}),n=angular.element(document).find(".image-layer__container"),n.on("click",function(){return i.html(""),i.removeClass("image-layer__overlay")})})}}}]).directive("downloadFromUrl",["$q","toaster","DownloadService",function(t,e,r){return{restrict:"A",link:function(i,n,s){return n.on("click",function(){var i,n;return n=-1===s.url.indexOf("[")?[s.url]:JSON.parse(s.url),i=[],e.pop("wait","Now Downloading ...","",0,"trustedHtml"),n.forEach(function(t,e){return i.push(r.exec(t,s.filename,e))}),t.all(i).then(function(){return e.clear(),e.pop("success","Finished Download","",2e3,"trustedHtml")})})}}}]).directive("icNavAutoclose",function(){return function(t,e){var r,i;r=$(e).find(".navbar-collapse"),i=!1,r.on("show.bs.collapse",function(){i=!0}),r.on("hide.bs.collapse",function(){i=!1}),$(e).find("a").each(function(t,e){$(e).click(function(t){-1===t.target.className.indexOf("dropdown-toggle")&&i&&"auto"===r.css("overflow-y")&&r.collapse("hide")})})}}).directive("clearLocalStorage",["toaster",function(t){return{restrict:"A",link:function(e,r){return r.on("click",function(){return t.pop("wait","Now Clearing ...","",0,"trustedHtml"),window.localStorage.clear(),t.clear(),t.pop("success","Finished clearing the list data","",2e3,"trustedHtml")})}}}]);var __hasProp={}.hasOwnProperty,__extends=function(t,e){function r(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},__bind=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("myApp.factories",[]).factory("Tweets",["$http","$q","ToasterService","TweetService","ListService",function(t,e,r,i,n){var s;return s=function(){function t(t,e,r,i){null==e&&(e=void 0),this.checkError=__bind(this.checkError,this),this.assignTweet=__bind(this.assignTweet,this),this.normalizeTweet=__bind(this.normalizeTweet,this),this.busy=!1,this.isLast=!1,this.method=null,this.count=40,this.items=t,this.maxId=e,this.type=r,this.twitterIdStr=i||null}return t.prototype.normalizeTweet=function(t){return new Promise(function(e){return function(r,s){var a;return null!=t.error&&s(t.error),_.isEmpty(t.data)&&s({statusCode:10100}),e.maxId=i.decStrNum(_.last(t.data).id_str),a=i.normalizeTweets(t.data,n.amatsukaList.member),r(a)}}(this))},t.prototype.assignTweet=function(t){return new Promise(function(r){return function(i,n){_.isEmpty(t)&&n({statusCode:100110}),function(){e.all(t.map(function(t){return[r.items][0].push(t)})).then(function(){return r.busy=!1})}()}}(this))},t.prototype.checkError=function(t){switch(t){case 429:r.warning({title:"ツイート取得API制限",text:"15分お待ちください"});break;case 10100:this.isLast=!0,this.busy=!1,r.success({title:"全ツイート取得完了",text:"全て読み込みました"});break;case 10110:this.busy=!1}},t.prototype.nextPage=function(){return this.busy||this.isLast?void 0:(this.method="user_timeline"===this.type?i.getUserTimeline({twitterIdStr:this.twitterIdStr,maxId:this.maxId,count:this.count}):"fav"===this.type?i.getFavLists({twitterIdStr:this.twitterIdStr,maxId:this.maxId,count:this.count}):i.getListsStatuses({listIdStr:n.amatsukaList.data.id_str,maxId:this.maxId,count:this.count}),this.busy=!0,function(t){return function(){t.method.then(function(e){return t.normalizeTweet(e)}).then(function(e){return t.assignTweet(e)})["catch"](function(e){return t.checkError(e.statusCode)})}}(this)())},t}()}]).factory("Pict",["$q","toaster","TweetService",function(t,e,r){var i;return i=function(){function t(){this.busy=!1,this.isLast=!1,this.limit=10,this.skip=0,this.items=[],this.numIllustorator=0,this.numMaxSkip=0,this.doneSkip=[]}return t.prototype.randomAccess=function(){for(var t;;)if(t=_.sample(_.range(this.numMaxSkip)),!this.doneSkip.includes(t)||this.doneSkip.length>=this.numMaxSkip)break;this.doneSkip.push(t),this.skip=t*this.limit,r.getPict({skip:this.skip,limit:this.limit}).then(function(t){return function(e){return t.items=t.items.concat(e),t.skip+=t.limit,t.doneSkip.length>=t.numMaxSkip&&(t.isLast=!0),t.busy=!1}}(this))},t.prototype.load=function(){return this.busy||this.isLast?void 0:(this.busy=!0,0!==this.numIllustorator?void this.randomAccess():r.getPictCount().then(function(t){return function(e){return t.numIllustorator=e,t.numMaxSkip=(t.numIllustorator-1)/t.limit,t.randomAccess()}}(this)))},t}()}]).factory("Member",["$q","toaster","TweetService","ListService",function(t,e,r,i){var n;return n=function(){function e(t,e){this.name=t,this.idStr=e,this.isLast=!1,this.count=20,this.nextCursor=-1,this.members=[],this.memberIdx=0,this.amatsukaListIdStr=i.amatsukaList.data.id_str}return e.prototype.loadMember=function(){return r.getFollowingList({twitterIdStr:this.idStr,nextCursor:this.nextCursor,count:200}).then(function(t){return function(e){return _.isEmpty(e.data.users)||(t.members=t.members.concat(i.normalizeMembersForCopy(e.data.users)),t.nextCursor=e.data.next_cursor_str,0===e.data.next_cursor)?void 0:t.loadMember()}}(this))},e.prototype.copyMember2AmatsukaList=function(){return t(function(t){return function(e,i){var n;return 0===t.members.length?i("member is nothing"):(n="",_.each(t.members,function(t){return n+=""+t.id_str+","}),r.createAllListsMembers({listIdStr:t.amatsukaListIdStr,twitterIdStr:n}).then(function(t){return e(t)})["catch"](function(t){return i(t)}))}}(this))},e}()}]).factory("List",["$q","toaster","TweetService","ListService","Member",function(t,e,r,i,n){var s;return s=function(t){function e(t,r){e.__super__.constructor.call(this,t,r)}return __extends(e,t),e.prototype.loadMember=function(){return r.getListsMembers({listIdStr:this.idStr,count:1e3}).then(function(t){return function(e){return t.members=i.normalizeMembersForCopy(e.data.users)}}(this))},e}(n)}]).factory("AmatsukaList",["TweetService","ListService",function(t,e){var r;return r=function(){function t(t){this.name=t,this.isLast=!1,this.count=20,this.members=[],this.memberIdx=0,this.idStr=(JSON.parse(localStorage.getItem("amatsukaList"))||{}).id_str,this.amatsukaMemberList=e.normalizeMembers(JSON.parse(localStorage.getItem("amatsukaFollowList")))||[],this.amatsukaMemberLength=this.amatsukaMemberList.length}return t.prototype.updateAmatsukaList=function(){return e.update().then(function(t){return function(r){return t.idstr=e.amatsukaList.data.id_str,t.amatsukaMemberList=e.normalizeMembers(r),t.amatsukaMemberLength=t.amatsukaMemberList.length,t.length=t.amatsukaMemberLength,t.isLast=!0,void(t.members=t.amatsukaMemberList)}}(this))},t.prototype.loadMoreMember=function(){this.isLast||(this.members=this.members.concat(this.amatsukaMemberList.slice(this.memberIdx,this.memberIdx+this.count)),this.memberIdx+=this.count,this.memberIdx>this.amatsukaMemberLength&&(this.isLast=!0))},t}()}]),angular.module("myApp.filters",[]).filter("interpolate",["version",function(t){return function(e){return String(e).replace(/\%VERSION\%/g,t)}}]).filter("noHTML",function(){return function(t){return null!=t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/,"&amp;"):void 0}}).filter("newlines",["$sce",function(t){return function(e){return t.trustAsHtml(null!=e?e.replace(/\n/g,"<br />"):"")}}]).filter("trusted",["$sce",function(t){return function(e){return t.trustAsResourceUrl(e)}}]),angular.module("myApp.services",[]),angular.module("myApp.controllers").controller("AdminUserCtrl",["$scope","$location","AuthService",function(t,e,r){return t.isLoaded=!1,t.isAuthenticated=r.status.isAuthenticated,r.status.isAuthenticated?void(t.isLoaded=!0):r.isAuthenticated().success(function(i){return _.isNull(i.data)?(t.isLoaded=!0,void e.path("/")):(r.status.isAuthenticated=!0,t.isAuthenticated=r.status.isAuthenticated,r.user=i.data,t.user=i.data,t.isLoaded=!0)}).error(function(){return void 0})}]),angular.module("myApp.controllers").controller("AmatsukaListCtrl",["AuthService","ListService",function(t,e){var r,i;if(!_.isEmpty(t.user))return i=localStorage.getItem("amatsukaList"),i="undefined"===i?{}:JSON.parse(i),r=localStorage.getItem("amatsukaFollowList"),r="undefined"===r?[]:JSON.parse(r),_.isEmpty(i)&&window.localStorage.clear(),e.amatsukaList={data:i,member:r}}]),angular.module("myApp.controllers").controller("ConfigCtrl",["$scope","$location","AuthService","ConfigService",function(t,e,r,i){return _.isEmpty(r.user)&&e.path("/"),i.getFromDB().then(function(t){return i.set(t)})["catch"](function(){return i.init()})["finally"](function(){return t.config=i.config}),t.$watch("config",function(t,e){JSON.stringify(t)!==JSON.stringify(e)&&_.isNumber(t.favLowerLimit)&&(i.update(),i.save2DB().then(function(){return void 0})["catch"](function(){return void 0}))},!0)}]),angular.module("myApp.controllers").controller("ExtractCtrl",["$scope","$routeParams","$location","Tweets","AuthService","TweetService","ListService",function(t,e,r,i,n,s,a){var o,u;return _.isEmpty(n.user)&&r.path("/"),a.hasListData()||r.path("/"),t.listIdStr=a.amatsukaList.data.id_str,t.filter={screenName:"",keyword:"",isIncludeRetweet:!1},t.extract={},t.extract.tweets=[],o=function(e){return null==e&&(e={screenName:t.filter.screenName}),t.isLoading=!0,s.showUsers(e).then(function(e){return t.extract.user=a.normalizeMember(e.data)}).then(function(e){return s.getAllPict({twitterIdStr:e.id_str,isIncludeRetweet:t.filter.isIncludeRetweet})}).then(function(e){return _.chain(e).filter(function(e){return~e.text.indexOf(t.filter.keyword)}).value()}).then(function(e){var r;return r=s.normalizeTweets(e,a.amatsukaList.member),t.extract.tweets=r.sort(function(t,e){return e.totalNum-t.totalNum}),t.isLoading=!1})},void 0===e.id||(u=e.id.indexOf(!1)?{screenName:e.id}:{twitterIdStr:e.id},o(u)),t.execFilteringPictWithKeyword=function(){return o()},t.$on("addMember",function(e,r){s.applyFollowStatusChange(t.extract.tweets,r)}),t.$on("resize::resize",function(e,r){t.$apply(function(){t.layoutType=r.layoutType})})}]),angular.module("myApp.controllers").controller("FavCtrl",["$scope","$location","AuthService","TweetService","ListService","Tweets",function(t,e,r,i,n,s){return _.isEmpty(r.user)&&e.path("/"),n.hasListData()||e.path("/"),t.isLoaded=!1,t.layoutType="grid",t.tweets=new s([],void 0,"fav",r.user._json.id_str),t.listIdStr=n.amatsukaList.data.id_str,t.isLoaded=!0,t.$on("addMember",function(e,r){i.applyFollowStatusChange(t.tweets.items,r)}),t.$on("resize::resize",function(e,r){t.$apply(function(){t.layoutType=r.layoutType})})}]),angular.module("myApp.controllers").controller("FindCtrl",["$scope","$location","AuthService","ListService","Pict",function(t,e,r,i,n){return _.isEmpty(r.user)&&e.path("/"),i.hasListData()||e.path("/"),t.pictList=new n}]),angular.module("myApp.controllers").controller("HelpCtrl",["$scope","$location","AuthService",function(t,e,r){return _.isEmpty(r.user)?e.path("/"):void 0}]),angular.module("myApp.controllers").controller("IndexCtrl",["$scope","$location","AuthService","TweetService","ListService","ConfigService","Tweets",function(t,e,r,i,n,s,a){var o;if(!_.isEmpty(r.user))return _.isEmpty(n.amatsukaList.data)&&window.localStorage.clear(),t.listIdStr="",t.isLoaded=!1,t.layoutType="grid",t.message="リストデータの確認中",o=function(){return t.message="リストデータの更新中",n.update().then(function(){t.tweets=new a([])})["catch"](function(){return t.message="リストを作成中",n.init().then(function(){return s.init(),s.save2DB()}).then(function(){return t.tweets=new a([])})})["finally"](function(){return t.message=""})},n.isSameAmatsukaList().then(function(e){return e?(t.tweets=new a([]),void function(){n.update().then(function(){return void 0})}()):o()})["catch"](function(){return void 0})["finally"](function(){s.getFromDB().then(function(e){return t.config=e}),t.listIdStr=n.amatsukaList.data.id_str,t.isLoaded=!0,t.message=""}),t.$on("addMember",function(e,r){i.applyFollowStatusChange(t.tweets.items,r)}),t.$on("resize::resize",function(e,r){t.$apply(function(){t.layoutType=r.layoutType})})}]),angular.module("myApp.controllers").controller("ListCtrl",["$scope","$location","AuthService","TweetService","ListService","List","Member","AmatsukaList",function(t,e,r,i,n,s,a,o){return _.isEmpty(r.user)&&e.path("/"),n.hasListData()||e.path("/"),t.amatsukaList=new o("Amatsuka"),i.getListsList(r.user._json.id_str).then(function(e){var i,n;return i=_.reject(e.data,function(t){return t.full_name==="@"+r.user.username+"/amatsuka"}),t.ownList=i||[],n={name:"friends",full_name:"friends",id_str:r.user.id_str,uri:"/following"},t.ownList.push(n)})["catch"](function(){return void 0}),t.$watch("sourceListData",function(e){return null!=(null!=e?e.name:void 0)?function(){t.sourceList={},t.sourceList="friends"===e.name?new a(e.name,r.user._json.id_str):new s(e.name,e.id_str),t.sourceList.loadMember()}():void 0}),t.$on("list:addMember",function(){t.amatsukaList.updateAmatsukaList()}),t.$on("list:copyMember",function(){t.amatsukaList.updateAmatsukaList(),t.sourceList.members=n.changeFollowStatusAllMembers(t.sourceList.members,!0),$(".btn-follow").each(function(){return this.innerText="フォロー解除"})}),t.$on("list:removeMember",function(){t.amatsukaList.updateAmatsukaList()})}]),angular.module("myApp.controllers").controller("MemberCtrl",["$scope","$location","AuthService","ListService","AmatsukaList",function(t,e,r,i,n){return _.isEmpty(r.user)&&e.path("/"),i.hasListData()||e.path("/"),t.list=new n("Amatsuka"),t.$watch("searchWord.screen_name",function(e,r){var i,n,s,a,o;if(e!==r){if(""!==e)return t.list.members=t.list.amatsukaMemberList.filter(function(t){return-1!==t.screen_name.indexOf(e)});for(t.list.members=[],t.list.memberIdx=0,o=t.list.amatsukaMemberList,i=s=0,a=o.length;a>s;i=++s){if(n=o[i],i>20)return;t.list.members.push(n),t.list.memberIdx++}}})}]),angular.module("myApp.controllers").controller("UserCtrl",["$scope","$location","ConfigService","TweetService","ListService","Tweets",function(t,e,r,i,n,s){return t.isOpened=!1,t.config={},t.$on("userData",function(e,r){t.isOpened&&(t.user=n.normalizeMember(r),t.listIdStr=n.amatsukaList.data.id_str)}),t.$on("tweetData",function(e,n){var a,o;t.isOpened&&(r.getFromDB().then(function(e){return t.config=e}),a=null!=_.last(n)?i.decStrNum(_.last(n).id_str):0,o=i.normalizeTweets(n),t.tweets=new s(o,a,"user_timeline",t.user.id_str))}),t.$on("isOpened",function(){t.isOpened=!0,t.user={},t.tweets={}}),t.$on("isClosed",function(){t.isOpened=!1,t.user=null,t.tweets=null}),t.$on("addMember",function(e,r){_.isUndefined(t.tweets)||i.applyFollowStatusChange(t.tweets.items,r)})}]),angular.module("myApp.directives").directive("appVersion",["version",function(t){return function(e,r){r.text(t)}}]),angular.module("myApp.directives").directive("copyMember",["$rootScope","toaster","TweetService",function(t,e){return{restrict:"A",scope:{sourceList:"="},link:function(r,i){return i.on("click",function(){return i.hasClass("disabled")?void 0:window.confirm("コピーしてもよろしいですか？")?(i.addClass("disabled"),e.pop("wait","Now Copying ...","",0,"trustedHtml"),r.sourceList.copyMember2AmatsukaList().then(function(r){return i.removeClass("disabled"),e.clear(),t.$broadcast("list:copyMember",r),e.pop("success","Finished copy member","",2e3,"trustedHtml")})):void 0})}}}]),angular.module("myApp.directives").directive("favoritable",["TweetService",function(t){return{restrict:"A",scope:{favNum:"=",favorited:"=",tweetIdStr:"@"},link:function(e,r){return e.favorited&&r.addClass("favorited"),r.on("click",function(){return e.favorited?(r.removeClass("favorited"),t.destroyFav({tweetIdStr:e.tweetIdStr}).then(function(){return e.favNum-=1,e.favorited=!e.favorited})):(r.addClass("favorited"),t.createFav({tweetIdStr:e.tweetIdStr}).then(function(){return e.favNum+=1,e.favorited=!e.favorited}))})}}}]).directive("retweetable",["TweetService",function(t){return{restrict:"A",scope:{retweetNum:"=",retweeted:"=",tweetIdStr:"@"},link:function(e,r){return e.retweeted&&r.addClass("retweeted"),r.on("click",function(){return e.retweeted?(r.removeClass("retweeted"),t.destroyStatus({tweetIdStr:e.tweetIdStr}).then(function(){return e.retweetNum-=1,e.retweeted=!e.retweeted})):window.confirm("リツイートしてもよろしいですか？")?(r.addClass("retweeted"),t.retweetStatus({tweetIdStr:e.tweetIdStr}).then(function(){return e.retweetNum+=1,e.retweeted=!e.retweeted})):void 0})}}}]).directive("followable",["$rootScope","ListService","TweetService",function(t,e,r){return{restrict:"E",replace:!0,scope:{listIdStr:"@",tweet:"@",followStatus:"="},template:'<span class="label label-default timeline__post--header--label">{{content}}</span>',link:function(i,n){var s,a,o;return a=JSON.parse(i.tweet),s=r.isRT(a),o=r.get(a,"user.id_str",s),i.followStatus===!1&&(i.content="+"),n.on("mouseover",function(){return i.content="フォロー",i.$apply()}),n.on("mouseout",function(){return i.content="+",i.$apply()}),n.on("click",function(){var s;return s={listIdStr:i.listIdStr,twitterIdStr:o},i.followStatus===!1?(n.addClass("label-success"),n.fadeOut(200),r.createListsMembers(s).then(function(){return e.addMember(o),t.$broadcast("addMember",o),r.collectProfile({twitterIdStr:o})}).then(function(){return void 0})):void 0})}}}]).directive("followable",["$rootScope","ListService","TweetService",function(t,e,r){return{restrict:"A",scope:{listIdStr:"@",twitterIdStr:"@",followStatus:"="},link:function(i,n){return n[0].innerText=i.followStatus?"フォロー解除":"フォロー",n.on("click",function(){var s;return s={listIdStr:i.listIdStr,twitterIdStr:i.twitterIdStr},i.isProcessing=!0,i.followStatus===!0&&(n[0].innerText="フォロー",r.destroyListsMembers(s).then(function(r){return e.removeMember(i.twitterIdStr),t.$broadcast("list:removeMember",r),i.isProcessing=!1})),i.followStatus===!1&&(n[0].innerText="フォロー解除",r.createListsMembers(s).then(function(n){return e.addMember(i.twitterIdStr),t.$broadcast("addMember",i.twitterIdStr),t.$broadcast("list:addMember",n),i.isProcessing=!1,r.collectProfile({twitterIdStr:i.twitterIdStr})}).then(function(){return void 0})),i.followStatus=!i.followStatus})}}}]).directive("showTweet",["$rootScope","TweetService",function(t,e){return{restrict:"A",scope:{twitterIdStr:"@"},link:function(r,i){var n;return n=function(){return e.showUsers({twitterIdStr:r.twitterIdStr}).then(function(i){return t.$broadcast("userData",i.data),e.getUserTimeline({twitterIdStr:r.twitterIdStr})}).then(function(e){return t.$broadcast("tweetData",e.data)})},i.on("click",function(){var e,r,i,s,a,o;return t.$broadcast("isOpened",!0),e=angular.element(document),i=e.find(".user-sidebar"),s=e.find(".user-sidebar__header"),(a=-1!==i[0].className.indexOf(".user-sidebar-in"))?void n():(i.addClass("user-sidebar-in"),s.removeClass("user-sidebar-out"),r=e.find("body"),r.addClass("scrollbar-y-hidden"),o=e.find(".layer"),o.addClass("fullscreen-overlay"),n(),o.on("click",function(){return r.removeClass("scrollbar-y-hidden"),o.removeClass("fullscreen-overlay"),i.removeClass("user-sidebar-in"),s.addClass("user-sidebar-out"),t.$broadcast("isClosed",!0)}))})}}}]).directive("newTweetLoad",["$rootScope","TweetService",function(t,e){return{restrict:"E",scope:{listIdStr:"@"},template:'<a class="btn" ng-disabled="isProcessing">{{text}}</a>',link:function(r,i){return r.text="新着を読み込む",i.on("click",function(){var i;return r.isProcessing=!0,i={listIdStr:r.listIdStr,count:50},e.getListsStatuses(i).then(function(e){return t.$broadcast("newTweet",e.data),r.text="新着を読み込む",r.isProcessing=!1})})}}}]).directive("showStatuses",["$compile","TweetService",function(t,e){return{restrict:"A",link:function(r,i,n){return i.on("click",function(){return e.showStatuses({tweetIdStr:n.tweetIdStr}).then(function(e){var i,n,s;return n='<div class="image-layer__caption">\n  <div class="timeline__post--footer">\n    <div class="timeline__post--footer--contents">\n      <div class="timeline__post--footer--contents--controls">\n        <a href="'+e.data.entities.media[0].expanded_url+'" target="_blank">\n          <i class="fa fa-twitter icon-twitter"></i>\n        </a>\n        <i class="fa fa-retweet icon-retweet" tweet-id-str="'+e.data.id_str+'" retweeted="'+e.data.retweeted+'" retweetable="retweetable"></i>\n        <i class="fa fa-heart icon-heart" tweet-id-str="'+e.data.id_str+'" favorited="'+e.data.favorited+'" favoritable="favoritable"></i>\n        <a><i class="fa fa-download" data-url="'+e.data.extended_entities.media[0].media_url_https+':orig" filename="'+e.data.user.screen_name+"_"+e.data.id_str+'" download-from-url="download-from-url"></i></a>\n      </div>\n    </div>\n  </div>\n</div>',i=angular.element(document).find(".image-layer"),_.isEmpty(i.html())?void 0:(s=t(n)(r).hide().fadeIn(300),i.append(s))})})}}}]);var __bind=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("myApp.factories").factory("Mao",["$q","$httpParamSerializer","ListService","MaoService","TweetService",function(t,e,r,i,n){var s;return s=function(){function t(t){this.date=t,this.normalizeTweets=__bind(this.normalizeTweets,this),this.busy=!1,this.isLast=!1,this.limit=20,this.skip=0,this.items=[],this.isAuthenticatedWithMao=!0}return t.prototype.normalizeTweets=function(t){return new Promise(function(){return function(e){var i,s,a,o;return t=t.map(function(t){return t.tweet=JSON.parse(t.tweetStr)}),o=n.normalizeTweets(t,r.amatsukaList.member),a=_(o).groupBy(function(t){return t.user.id_str}).value(),i=_.values(a),s=i.map(function(t){return{user:t[0].user,pictTweetList:t}}),s=s.map(function(t){var e;return e=_.flatten(t.pictTweetList.map(function(t){return t.extended_entities.media.map(function(e){return{tweet:t,media:e}})})),{user:t.user,pictList:e}}),e(s)}}(this))},t.prototype.load=function(){var t,r;if(!this.busy&&!this.isLast)return this.busy=!0,t={skip:this.skip,limit:this.limit,date:this.date},r=e(t),i.findByMaoTokenAndDate(r).then(function(t){return function(e){return t.normalizeTweets(e.data)}}(this)).then(function(t){return function(e){return 0===e.length?(t.busy=!1,void(t.isLast=!0)):(e.forEach(function(e){return t.items.push(e)}),t.skip+=t.limit,t.busy=!1)}}(this))["catch"](function(t){return function(){return t.isLast=!0,t.busy=!1,t.isAuthenticatedWithMao=!1}}(this))},t}()}]),angular.module("myApp.services").service("AuthService",["$http",function(t){return{isAuthenticated:function(){return t.get("/isAuthenticated")},status:{isAuthenticated:!1},user:{}}}]),angular.module("myApp.services").service("ConfigService",["$http","$q",function(t,e){return{config:{},set:function(t){return this.config=t},get:function(){return new Promise(function(t){return function(e){return _.isEmpty(t.config)?t.getFromDB().then(function(r){return t.set(r),e(r)}):e(t.config)}}(this))},update:function(){localStorage.setItem("amatsuka.config",JSON.stringify(this.config))},init:function(){return this.config={includeRetweet:!0,ngUsername:[],ngWord:[]},localStorage.setItem("amatsuka.config",JSON.stringify(this.config))},getFromDB:function(){return e(function(e,r){return t.get("/api/config").success(function(t){return _.isNull(t.data)?r("Not found data"):e(JSON.parse(t.data.configStr))}).error(function(t){return r(t||"getFromDB Request failed")})})},save2DB:function(){return e(function(e){return function(r,i){return t.post("/api/config",{config:e.config}).success(function(t){return r(t)}).error(function(t){return i(t||"save2DB Request failed")})}}(this))}}}]),angular.module("myApp.services").service("ConvertService",function(){return{base64toBlob:function(t){var e,r,i,n,s,a;for(n=void 0,a=t.split(","),i=atob(a[1]),s=a[0].split(":")[1].split(";")[0],e=new Uint8Array(i.length),n=0;n<i.length;)e[n]=i.charCodeAt(n),n++;return r=new Blob([e],{type:s})}}}),angular.module("myApp.services").service("DownloadService",["$http","ConvertService",function(t,e){return{exec:function(r,i,n){return t.post("/api/download",{url:r}).success(function(t){return function(s){var a,o;return a=e.base64toBlob(s.base64Data),o=/media\/.*\.(png|jpg|jpeg):orig/.exec(r)[1],i=""+i+"_"+n+"."+o,t.saveAs(a,i)}}(this))},saveAs:function(t,e){var r;return navigator.appVersion.toString().indexOf(".NET")>0?window.navigator.msSaveBlob(t,e):(r=document.createElement("a"),document.body.appendChild(r),r.style="display: none",r.href=window.URL.createObjectURL(t),r.download=e,r.click())}}}]),angular.module("myApp.services").service("ListService",["$http","$q","AuthService","TweetService",function(t,e,r,i){return{amatsukaList:{data:[],member:{}},registerMember2LocalStorage:function(){localStorage.setItem("amatsukaFollowList",JSON.stringify(this.amatsukaList.member))},addMember:function(t){return i.showUsers({twitterIdStr:t}).then(function(t){return function(e){return t.amatsukaList.member.push(e.data),t.registerMember2LocalStorage()}}(this))},removeMember:function(t){this.amatsukaList.member=_.reject(this.amatsukaList.member,{id_str:t}),this.registerMember2LocalStorage()},isFollow:function(t,e){var r;return null==e&&(e=!0),r=t.id_str,_.has(t,"user")&&(r=i.get(t,"user.id_str",e)),!!_.findWhere(this.amatsukaList.member,{id_str:r})},normalizeMembers:function(t){return _.each(t,function(t){t.followStatus=!0,t.description=i.activateLink(t.description),t.profile_image_url_https=i.iconBigger(t.profile_image_url_https)})},changeFollowStatusAllMembers:function(t,e){return _.map(t,function(t){return t.followStatus=e,t})},normalizeMember:function(t){var e,r;return e=i.getExpandedURLFromDescription(t.entities),r=i.getExpandedURLFromURL(t.entities),_.each(e,function(e){t.description=t.description.replace(e.url,e.expanded_url)}),_.each(r,function(e){t.url=t.url.replace(e.url,e.expanded_url)}),t.followStatus=this.isFollow(t),t.description=i.activateLink(t.description),t.profile_image_url_https=i.iconBigger(t.profile_image_url_https),t},normalizeMembersForCopy:function(t){return _.each(t,function(t){return function(e){e.followStatus=t.isFollow(e),e.isPermissionCopy=!0,e.profile_image_url_https=i.iconBigger(e.profile_image_url_https)}}(this))},update:function(){return i.getListsList({twitterIdStr:r.user._json.id_str}).then(function(t){return function(e){return t.amatsukaList.data=_.findWhere(e.data,{full_name:"@"+r.user.username+"/amatsuka"}),localStorage.setItem("amatsukaList",JSON.stringify(t.amatsukaList.data)),i.getListsMembers({listIdStr:t.amatsukaList.data.id_str})}}(this)).then(function(t){return function(e){return t.amatsukaList.member=e.data.users,localStorage.setItem("amatsukaFollowList",JSON.stringify(t.amatsukaList.member)),e.data.users}}(this))},init:function(){return i.createLists({name:"Amatsuka",mode:"private"}).then(function(t){return function(e){var r;return t.amatsukaList.data=e.data,localStorage.setItem("amatsukaList",JSON.stringify(e.data)),r={listIdStr:e.data.id_str,twitterIdStr:void 0},i.createAllListsMembers(r)}}(this)).then(function(t){return i.getListsMembers({listIdStr:t.data.id_str})}).then(function(t){return function(e){return t.amatsukaList.member=e.data.users,localStorage.setItem("amatsukaFollowList",JSON.stringify(e.data.users)),e.data.users}}(this))},getAmatsukaList:function(){return e(function(){return function(t){return i.getListsList({twitterIdStr:r.user._json.id_str}).then(function(e){var i;return i=e.data,t(_.findWhere(i,{full_name:"@"+r.user.username+"/amatsuka"})||{id_str:null})})}}(this))},isSameAmatsukaList:function(){return e(function(t){return function(e,r){return t.getAmatsukaList().then(function(t){var r;return r=JSON.parse(localStorage.getItem("amatsukaList"))||{},e(r.id_str===t.id_str)})["catch"](function(t){return r(t)})}}(this))},hasListData:function(){return!(_.isEmpty(this.amatsukaList.data)&&_.isEmpty(this.amatsukaList.member))}}}]),angular.module("myApp.services").service("MaoService",["$http",function(t){return{findByMaoTokenAndDate:function(e){return t.get("/api/mao?"+e)}}}]),angular.module("myApp.services").service("ToasterService",["toaster",function(t){return{success:function(e){return t.pop("success",e.title,e.text,2e3,"trustedHtml")},warning:function(e){return t.pop("warning",e.title,e.text,2e3,"trustedHtml")}}}]),angular.module("myApp.services").service("TweetService",["$http","$q","$injector","ConfigService","ToasterService","toaster",function(t,e,r,i,n,s){return{activateLink:function(t){return t.replace(/((ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&amp;%@!&#45;\/]))?)/g,'<a href="$1" target="_blank">$1</a>').replace(/(^|\s)(@|＠)(\w+)/g,'$1<a href="http://www.twitter.com/$3" target="_blank">@$3</a>').replace(/(?:^|[^ーー゛゜々ヾヽぁ-ヶ一-龠ａ-ｚＡ-Ｚ０-９a-zA-Z0-9&_\/>]+)[#＃]([ー゛゜々ヾヽぁ-ヶ一-龠ａ-ｚＡ-Ｚ０-９a-zA-Z0-9_]*[ー゛゜々ヾヽぁ-ヶ一-龠ａ-ｚＡ-Ｚ０-９a-zA-Z]+[ー゛゜々ヾヽぁ-ヶ一-龠ａ-ｚＡ-Ｚ０-９a-zA-Z0-9_]*)/g,' <a href="http://twitter.com/search?q=%23$1" target="_blank">#$1</a>')},iconBigger:function(t){return _.isUndefined(t)?this.replace("normal","bigger"):t.replace("normal","bigger")},hasOrigParameter:function(){return void 0},applyFollowStatusChange:function(t,e){return _.map(t,function(t){return function(r){var i,n;return n=_.has(r,"retweeted_status"),i=t.get(r,"user.id_str",n),i===e?r.followStatus=!0:void 0}}(this))},normalizeTweets:function(t){var e;return e=r.get("ListService"),_.map(t,function(t){return function(r){var i;return i=_.has(r,"retweeted_status"),r.isRT=i,r.followStatus=e.isFollow(r,i),r.text=t.expandTweetUrl(r,i),r.time=t.fromNow(t.get(r,"tweet.created_at",!1)),r.retweetNum=t.get(r,"tweet.retweet_count",i),r.favNum=t.get(r,"tweet.favorite_count",i),r.tweetIdStr=t.get(r,"tweet.id_str",i),r.sourceUrl=t.get(r,"display_url",i),r.picUrlList=t.get(r,"media_url_https:small",i),r.picOrigUrlList=t.get(r,"media_url_https:orig",i),r.video_url=t.get(r,"video_url",i),r.fileName=t.get(r,"screen_name",i)+"_"+t.get(r,"tweet.id_str",i),r.user.profile_image_url_https=t.iconBigger(r.user.profile_image_url_https),r
}}(this))},isRT:function(t){return _.has(t,"retweeted_status")},get:function(t,e,r){var i,n,s,a,o,u,c,l,d;switch(i=r?t.retweeted_status:t,e){case"description":return i.user.description;case"display_url":return null!=(n=i.entities)&&null!=(s=n.media)?s[0].display_url:void 0;case"entities":return i.entities;case"expanded_url":return null!=(a=i.entities)&&null!=(o=a.media)?o[0].expanded_url:void 0;case"followers_count":return i.user.followers_count;case"friends_count":return i.user.friends_count;case"hashtags":return null!=(u=i.entities)?u.hashtags:void 0;case"media_url":return _.map(i.extended_entities.media,function(t){return t.media_url});case"media_url_https":return _.map(i.extended_entities.media,function(t){return t.media_url_https});case"media_url:orig":return _.map(i.extended_entities.media,function(t){return t.media_url+":orig"});case"media_url_https:orig":return _.map(i.extended_entities.media,function(t){return t.media_url_https+":orig"});case"media_url_https:small":return _.map(i.extended_entities.media,function(t){return t.media_url_https+":small"});case"video_url":return null!=(c=i.extended_entities)&&null!=(l=c.media[0])&&null!=(d=l.video_info)?d.variants[0].url:void 0;case"name":return i.user.name;case"profile_banner_url":return i.user.profile_banner_url;case"profile_image_url":return i.user.profile_image_url;case"profile_image_url_https":return i.user.profile_image_url_https;case"statuses_count":return i.user.statuses_count;case"screen_name":return i.user.screen_name;case"source":return i.source;case"text":return i.text;case"timestamp_ms":return i.timestamp_ms;case"tweet.created_at":return i.created_at;case"tweet.favorite_count":return i.favorite_count;case"tweet.retweet_count":return i.retweet_count;case"tweet.id_str":return i.id_str;case"tweet.lang":return i.lang;case"user.created_at":return i.user.created_at;case"user.id_str":return i.user.id_str;case"user.favorite_count":return i.favorite_count;case"user.retweet_count":return i.retweet_count;case"user.lang":return i.user.lang;case"user.url":return i.user.url;default:return null}},expandTweetUrl:function(t,e){var r;return t.text=this.get(t,"text",e),r=this.getExpandedURLFromTweet(t.entities),_.each(r,function(){return function(e){t.text=t.text.replace(e.url,e.expanded_url)}}(this)),t.text=this.activateLink(t.text),t.text},getExpandedURLFromTweet:function(t){return _.has(t,"urls")?t.urls:""},getExpandedURLFromURL:function(t){return _.has(t,"url")?t.url.urls:""},getExpandedURLFromDescription:function(t){return _.has(t,"description")&&_.has(t.description,"urls")?t.description.urls:""},decStrNum:function(t){var e,r;for(t=t.toString(),r=t,e=t.length-1;e>-1;){if("0"!==t[e])return r=r.substring(0,e)+(parseInt(t[e],10)-1).toString()+r.substring(e+1);r=r.substring(0,e)+"9"+r.substring(e+1),e--}return r},fromNow:function(t){return moment(t).fromNow(!0)},filterIncludeImage:function(t){return _.reject(t,function(t){return!_.has(t,"extended_entities")||_.isEmpty(t.extended_entities.media)})},collectProfile:function(r){return e(function(e,i){return t.post("/api/collect/profile",r).success(function(t){return e(t)}).error(function(t){return i(t)})})},getPict:function(r){return e(function(e,i){return t.get("/api/collect/"+r.skip+"/"+r.limit).success(function(t){return e(t)}).error(function(t){return i(t)})})},getPictCount:function(){return e(function(e,r){return t.get("/api/collect/count").success(function(t){return e(t.count)}).error(function(t){return r(t)})})},getAllPict:function(t){return e(function(e){return function(r){var i,n,a;return a=[],n=n||0,(i=function(){return e.getUserTimeline({twitterIdStr:t.twitterIdStr,maxId:n,count:200,isIncludeRetweet:t.isIncludeRetweet}).then(function(t){return _.isUndefined(t.data)?(s.pop("error","API制限。15分お待ち下さい。"),r(a)):0===t.data.length?(s.pop("success","最後まで読み終えました。"),r(a)):(n=e.decStrNum(t.data[t.data.length-1].id_str),_.each(t.data,function(t){t.totalNum=t.retweet_count+t.favorite_count,t.tweetIdStr=t.id_str}),a=a.concat(t.data),i())})})()}}(this))},checkError:function(t){switch(t){case 429:n.warning({title:"API制限",text:"15分お待ちください"})}},getListsList:function(r){return e(function(e){return function(i,n){return t.get("/api/lists/list/"+r.twitterIdStr).success(function(t){return _.has(t,"error")?(e.checkError(t.error.statusCode),n(t)):i(t)}).error(function(t){return n(t)})}}(this))},createLists:function(r){return e(function(e,i){return t.post("/api/lists/create",r).success(function(t){return e(t)}).error(function(t){return i(t)})})},getListsMembers:function(r){return e(function(e,i){return t.get("/api/lists/members/"+r.listIdStr+"/"+r.count).success(function(t){return e(t)}).error(function(t){return i(t)})})},getListsStatuses:function(r){return e(function(e,i){return t.get("/api/lists/statuses/"+r.listIdStr+"/"+r.maxId+"/"+r.count).success(function(t){return e(t)}).error(function(t){return i(t)})})},createListsMembers:function(r){return e(function(e,i){return t.post("/api/lists/members/create",r).success(function(t){return e(t)}).error(function(t){return i(t)})})},createAllListsMembers:function(r){return e(function(e,i){return t.post("/api/lists/members/create_all",r).success(function(t){return e(t)}).error(function(t){return i(t)})})},destroyListsMembers:function(r){return e(function(e){return t.post("/api/lists/members/destroy",r).success(function(t){return e(t)})})},getUserTimeline:function(r){return e(function(e,i){return t.get("/api/timeline/"+r.twitterIdStr+"/"+r.maxId+"/"+r.count+"?isIncludeRetweet="+r.isIncludeRetweet).success(function(t){return e(t)}).error(function(t){return i(t)})})},getFollowingList:function(r){return e(function(e){return t.get("/api/friends/list/"+r.twitterIdStr+"/"+r.count).success(function(t){return e(t)})})},showStatuses:function(r){return e(function(e){return t.get("/api/statuses/show/"+r.tweetIdStr).success(function(t){return e(t)})})},showUsers:function(r){return e(function(e){return t.get("/api/users/show/"+r.twitterIdStr+"/"+r.screenName).success(function(t){return e(t)})})},getFavLists:function(r){return e(function(e){return t.get("/api/favorites/lists/"+r.twitterIdStr+"/"+r.maxId+"/"+r.count).success(function(t){return e(t)})})},createFav:function(r){return e(function(e){return t.post("/api/favorites/create",r).success(function(t){return e(t)})})},destroyFav:function(r){return e(function(e){return t.post("/api/favorites/destroy",r).success(function(t){return e(t)})})},retweetStatus:function(r){return e(function(e){return t.post("/api/statuses/retweet",r).success(function(t){return e(t)})})},destroyStatus:function(r){return e(function(e){return t.post("/api/statuses/destroy",r).success(function(t){return e(t)})})}}}]);var MaoListContoller;angular.module("myApp.directives").directive("maoListContainer",function(){return{restrict:"E",scope:{},template:'<dot-loader ng-if="!$ctrl.tweetList.items" class="user-sidebar__contents--box-loading-init">\n</dot-loader>\n<div ng-if="$ctrl.tweetList.isAuthenticatedWithMao">\n  <div infinite-scroll="$ctrl.tweetList.load()" infinite-scroll-distance="0" class="row-eq-height">\n    <div style="padding: 15px;" ng-repeat="item in $ctrl.tweetList.items" class="col-lg-4 col-md-6 col-sm-6">\n      <mao-tweet-article item="item"></mao-tweet-article>\n    </div>\n  </div>\n  <div class="col-sm-12">\n    <dot-loader ng-if="$ctrl.tweetList.busy" class="infinitescroll-content">\n    </dot-loader>\n    <div ng-show="$ctrl.tweetList.isLast" class="text-center infinitescroll-content infinitescroll-message">終わりです\n    </div>\n  </div>\n</div>\n<div ng-if="!$ctrl.tweetList.isAuthenticatedWithMao" class="col-sm-12">\n  <div class="infinitescroll-message">\n    <p>MaoでのTwitter認証がされていないのでこの機能は利用できません。</p>\n    <p>MaoはAmatsukaのメンバーの人気の画像を毎日収集し、閲覧できる機能です。</p>\n    <p>認証は以下のリンク先で行えます</p>\n    <p>\n      <a href="https://ma0.herokuapp.com" target="_blank" class="mao__link">\n        Mao\n        <i class="fa fa-external-link"></i>\n      </a>\n    </p>\n  </div>\n</div>',bindToController:{},controllerAs:"$ctrl",controller:MaoListContoller}}),MaoListContoller=function(){function t(t,e,r){var i;this.$location=t,this.Mao=e,this.ListService=r,this.ListService.amatsukaList={data:JSON.parse(localStorage.getItem("amatsukaList"))||{},member:JSON.parse(localStorage.getItem("amatsukaFollowList"))||[]},this.ListService.hasListData()||this.$location.path("/"),i=moment().add(-1,"days").format("YYYY-MM-DD"),this.tweetList=new this.Mao(i)}return t}(),MaoListContoller.$inject=["$location","Mao","ListService"];var MaoTweetArticleController;angular.module("myApp.directives").directive("maoTweetArticle",function(){return{restrict:"E",scope:{},template:'<div class="media find__media">\n  <a twitter-id-str="{{::$ctrl.item.user.id_str}}" show-tweet="show-tweet" class="pull-left">\n    <img ng-src="{{::$ctrl.item.user.profile_image_url_https}}" img-preload="img-preload" class="media-object thumbnail-img fade"/>\n  </a>\n  <div class="media-body">\n    <h4 class="media-heading"><span class="name">{{::$ctrl.item.user.name}}</span>\n      <span class="screen-name">@{{::$ctrl.item.user.screen_name}}</span>\n    </h4>\n    <a href="{{::$ctrl.item.user.url}}" target="_blank" class="link">{{::$ctrl.item.user.url}}</a>\n  </div>\n</div>\n<div class="find__pict-tweet--container">\n  <div class="row">\n    <div ng-repeat="pict in $ctrl.item.pictList | limitTo: 12" class="col-lg-6 col-md-4 col-sm-6 col-xs-6">\n      <div style="background-image: url(\'{{::pict.media.media_url_https}}:small\')" zoom-image="zoom-image" data-img-src="{{::pict.media.media_url_https}}:orig" tweet-id-str="{{::pict.tweet.id_str}}" show-statuses="show-statuses" class="find__pict-tweet--img">\n      </div>\n    </div>\n  </div>\n</div>',bindToController:{item:"="},controllerAs:"$ctrl",controller:MaoTweetArticleController}}),MaoTweetArticleController=function(){function t(){}return t}();var GridLayoutTweet;angular.module("myApp.directives").directive("gridLayoutTweet",function(){return{restrict:"E",scope:{},template:'<div class="timeline__post--header timeline__post--header--grid">\n  <div class="timeline__post--header--info timeline__post--header--info--grid">\n    <div class="timeline__post--header--link timeline__post--header--link--grid">\n      <span twitter-id-str="{{::$ctrl.tweet.user.id_str}}" show-tweet="show-tweet" class="timeline__post--header--user timeline__post--header--user--grid">{{::$ctrl.tweet.user.screen_name}}\n      </span><span ng-if="$ctrl.tweet.retweeted_status" class="timeline__post--header--rt_icon timeline__post--header--rt_icon--grid"><i class="fa fa-retweet"></i></span><a twitter-id-str="{{::$ctrl.tweet.retweeted_status.user.id_str}}" show-tweet="show-tweet" class="timeline__post--header--rt_source timeline__post--header--rt_source--grid">{{::$ctrl.tweet.retweeted_status.user.screen_name}}\n      </a>\n      <followable ng-if="!$ctrl.tweet.followStatus" list-id-str="{{$ctrl.listIdStr}}" tweet="{{$ctrl.tweet}}" follow-status="$ctrl.tweet.followStatus">\n      </followable>\n    </div>\n  </div>\n  <div class="timeline__post--header--time"><a href="https://{{::$ctrl.tweet.sourceUrl}}" target="_blank">{{::$ctrl.tweet.time}}\n    </a>\n  </div>\n</div>\n<div class="timeline__post--icon timeline__post--icon--grid"><img ng-src="{{::$ctrl.tweet.user.profile_image_url_https}}" img-preload="img-preload" show-tweet="show-tweet" twitter-id-str="{{::$ctrl.tweet.user.id_str}}" class="fade"/>\n</div>\n<div ng-repeat="picUrl in $ctrl.tweet.picUrlList" class="timeline__post--image timeline__post--image--grid">\n  <img ng-if="!$ctrl.tweet.video_url" ng-src="{{::picUrl}}" img-preload="img-preload" zoom-image="zoom-image" data-img-src="{{::picUrl}}" class="fade"/>\n  <video ng-if="$ctrl.tweet.video_url" poster="{{::picUrl}}" autoplay="autoplay" loop="loop" controls="controls" muted="muted">\n    <source ng-src="{{::$ctrl.tweet.video_url | trusted}}" type="video/mp4">\n    </source>\n  </video>\n</div>\n<div ng-if="!config.isShowOnlyImage" class="timeline__post__text__container">\n  <div ng-if="!$ctrl.tweet.retweeted_status" ng-bind-html="$ctrl.tweet.text | newlines" class="timeline__post--text timeline__post--text--grid">\n  </div>\n  <div ng-if="$ctrl.tweet.retweeted_status" class="timeline__post--blockquote timeline__post--blockquote--grid">\n    <p><a twitter-id-str="{{::$ctrl.tweet.retweeted_status.user.id_str}}" show-tweet="show-tweet">{{::$ctrl.tweet.retweeted_status.user.screen_name}}\n      </a>\n    </p>\n    <blockquote>\n      <div ng-bind-html="$ctrl.tweet.text | newlines" class="timeline__post--text">\n      </div>\n    </blockquote>\n  </div>\n</div>\n<div class="timeline__post--footer timeline__post--footer--grid">\n  <div class="timeline__post--footer--contents">\n    <div class="timeline__post--footer--contents--controls">\n      <i retweet-num="$ctrl.tweet.retweetNum" retweeted="$ctrl.tweet.retweeted" tweet-id-str="{{::$ctrl.tweet.tweetIdStr}}" retweetable="retweetable" class="fa fa-retweet icon-retweet">{{$ctrl.tweet.retweetNum}}</i><i fav-num="$ctrl.tweet.favNum" favorited="$ctrl.tweet.favorited" tweet-id-str="{{::$ctrl.tweet.tweetIdStr}}" favoritable="favoritable" class="fa fa-heart icon-heart">{{$ctrl.tweet.favNum}}</i>\n      <!-- aタグがないとtextとcontrolsの間の余白がなくなり、レイアウトが崩れる。--><a><i data-url="{{::$ctrl.tweet.picOrigUrlList}}" filename="{{::$ctrl.tweet.fileName}}" download-from-url="download-from-url" class="fa fa-download"></i></a>\n    </div>\n  </div>\n</div>',bindToController:{tweet:"=",listIdStr:"="},controllerAs:"$ctrl",controller:GridLayoutTweet}}),GridLayoutTweet=function(){function t(){}return t}();var ListLayoutTweet;angular.module("myApp.directives").directive("listLayoutTweet",function(){return{restrict:"E",scope:{},template:'\n<div class="timeline__post--header">\n  <div class="timeline__post--header--info">\n    <div class="timeline__post--header--link">\n      <span twitter-id-str="{{::$ctrl.tweet.user.id_str}}" show-tweet="show-tweet" class="timeline__post--header--user">{{::$ctrl.tweet.user.screen_name}}\n      </span><span ng-if="$ctrl.tweet.retweeted_status" class="timeline__post--header--rt_icon"><i class="fa fa-retweet"></i></span><a twitter-id-str="{{::$ctrl.tweet.retweeted_status.user.id_str}}" show-tweet="show-tweet" class="timeline__post--header--rt_source">{{::$ctrl.tweet.retweeted_status.user.screen_name}}\n      </a>\n      <followable ng-if="!$ctrl.tweet.followStatus" list-id-str="{{$ctrl.listIdStr}}" tweet="{{$ctrl.tweet}}" follow-status="$ctrl.tweet.followStatus">\n      </followable>\n    </div>\n  </div>\n  <div class="timeline__post--header--time"><a href="https://{{::$ctrl.tweet.sourceUrl}}" target="_blank">{{::$ctrl.tweet.time}}\n    </a>\n  </div>\n</div>\n<div class="timeline__post--icon"><img ng-src="{{::$ctrl.tweet.user.profile_image_url_https}}" img-preload="img-preload" show-tweet="show-tweet" twitter-id-str="{{::$ctrl.tweet.user.id_str}}" class="fade"/>\n</div>\n<div ng-repeat="picUrl in $ctrl.tweet.picUrlList" class="timeline__post--image">\n  <img ng-if="!$ctrl.tweet.video_url" ng-src="{{::picUrl}}" img-preload="img-preload" zoom-image="zoom-image" data-img-src="{{::picUrl}}" class="fade"/>\n  <video ng-if="$ctrl.tweet.video_url" poster="{{::picUrl}}" autoplay="autoplay" loop="loop" controls="controls" muted="muted">\n    <source ng-src="{{::$ctrl.tweet.video_url | trusted}}" type="video/mp4">\n    </source>\n  </video>\n</div>\n<div ng-if="!config.isShowOnlyImage" class="timeline__post__text__container">\n  <div ng-if="!$ctrl.tweet.retweeted_status" ng-bind-html="$ctrl.tweet.text | newlines" class="timeline__post--text">\n  </div>\n  <div ng-if="$ctrl.tweet.retweeted_status" class="timeline__post--blockquote">\n    <p><a twitter-id-str="{{::$ctrl.tweet.retweeted_status.user.id_str}}" show-tweet="show-tweet">{{::$ctrl.tweet.retweeted_status.user.screen_name}}\n      </a>\n    </p>\n    <blockquote>\n      <div ng-bind-html="$ctrl.tweet.text | newlines" class="timeline__post--text">\n      </div>\n    </blockquote>\n  </div>\n</div>\n<div class="timeline__post--footer">\n  <div class="timeline__post--footer--contents">\n    <div class="timeline__post--footer--contents--controls"><i retweet-num="$ctrl.tweet.retweetNum" retweeted="$ctrl.tweet.retweeted" tweet-id-str="{{::$ctrl.tweet.tweetIdStr}}" retweetable="retweetable" class="fa fa-retweet icon-retweet">{{$ctrl.tweet.retweetNum}}</i><i fav-num="$ctrl.tweet.favNum" favorited="$ctrl.tweet.favorited" tweet-id-str="{{::$ctrl.tweet.tweetIdStr}}" favoritable="favoritable" class="fa fa-heart icon-heart">{{$ctrl.tweet.favNum}}</i><a><i data-url="{{::$ctrl.tweet.extended_entities.media[0].media_url}}:orig" filename="{{::$ctrl.tweet.fileName}}" download-from-url="download-from-url" class="fa fa-download"></i></a>\n    </div>\n  </div>\n</div>\n',bindToController:{tweet:"=",listIdStr:"="},controllerAs:"$ctrl",controller:ListLayoutTweet}}),ListLayoutTweet=function(){function t(){}return t}();var TweetListController;angular.module("myApp.directives").directive("tweetListContainer",function(){return{restrict:"E",scope:{},template:'<dot-loader ng-if="!$ctrl.tweets.items" class="user-sidebar__contents--box-loading-init"></dot-loader>\n<div ng-if="$ctrl.message" class="list__status--message text-center">{{message}}\n</div>\n\n<span ng-if="$ctrl.layoutType == \'grid\'">\n  <div infinite-scroll="$ctrl.tweets.nextPage()" infinite-scroll-distance="2" infinite-scroll-disabled="$ctrl.tweets.busy" masonry="masonry" preserve-order="preserve-order" class="timeline timeline--grid">\n    <div ng-repeat="tweet in $ctrl.tweets.items" class="masonry-brick timeline__post timeline__post--grid">\n      <grid-layout-tweet tweet="tweet" listIdStr="$ctrl.listIdStr"></grid-layout-tweet>\n    </div>\n  </div>\n\n  <div class="loading-bar loading-bar--grid">\n    <dot-loader ng-if="$ctrl.tweets.busy" class="box-loading-padding-vertical">\n    </dot-loader>\n    <div ng-show="$ctrl.tweets.isLast" class="text-center">終わりです</div>\n  </div>\n</span>\n\n<span ng-if="$ctrl.layoutType == \'list\'">\n  <div infinite-scroll="$ctrl.tweets.nextPage()" infinite-scroll-distance="2" infinite-scroll-disabled="$ctrl.tweets.busy" class="timeline timeline--list">\n    <div ng-repeat="tweet in $ctrl.tweets.items" class="timeline__post">\n      <list-layout-tweet tweet="tweet"></list-layout-tweet>\n    </div>\n\n    <div class="loading-bar">\n      <dot-loader ng-if="$ctrl.tweets.busy" class="box-loading-padding-vertical">\n      </dot-loader>\n      <div ng-show="$ctrl.tweets.isLast" class="text-center">終わりです</div>\n    </div>\n  </div>\n</span>\n',bindToController:{},controllerAs:"$ctrl",controller:TweetListController}}),TweetListController=function(){function t(t,e,r,i,n,s){this.$location=t,this.$scope=e,this.AuthService=r,this.ListService=i,this.Tweets=n,this.TweetService=s,this.isLoaded=!1,this.layoutType="grid",this.ListService.amatsukaList={data:JSON.parse(localStorage.getItem("amatsukaList"))||{},member:JSON.parse(localStorage.getItem("amatsukaFollowList"))||[]},this.ListService.hasListData()||this.$location.path("/"),this.tweets=new this.Tweets([],void 0,"fav",this.AuthService.user._json.id_str),this.listIdStr=i.amatsukaList.data.id_str,this.isLoaded=!0,this.subscribe()}return t.prototype.subscribe=function(){return this.$scope.$on("addMember",function(t){return function(e,r){return t.TweetService.applyFollowStatusChange(t.tweets.items,r)}}(this)),this.$scope.$on("resize::resize",function(t){return function(e,r){return t.$scope.$apply(function(){return t.layoutType=r.layoutType})}}(this))},t}(),TweetListController.$inject=["$location","$scope","AuthService","ListService","Tweets","TweetService"];